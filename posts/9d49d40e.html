<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">


  <link rel="manifest" href="/images/manifest.json">


  <meta name="msapplication-config" content="/images/browserconfig.xml" />



  <meta name="keywords" content="机器学习,推荐,算法," />





  <link rel="alternate" href="/atom.xml" title="小火箭的博客" type="application/atom+xml" />






<meta name="description" content="参考原作：推荐系统三十六式-刑无刀 25.【常见架构】典型的信息流架构是什么样的在工程实践的部分中，我首先介绍的内容是当今最热门的信息流架构。信息流是推荐系统应用中的当红炸子鸡，它表现形式有很多：社交网络的动态信息流、新闻阅读的图文信息流、短视频信息流等等。 究竟。整体框架信息流，通常也叫作 feed，这个英文词也很有意思，就是“喂”给用户的意思。传统的信息流产品知识简单按照时间排序，而被推荐系统">
<meta property="og:type" content="article">
<meta property="og:title" content="推荐系统三十六式--学习笔记（25-27 常见架构）">
<meta property="og:url" content="https://www.xiemingzhao.com/posts/9d49d40e.html">
<meta property="og:site_name" content="小火箭的博客">
<meta property="og:description" content="参考原作：推荐系统三十六式-刑无刀 25.【常见架构】典型的信息流架构是什么样的在工程实践的部分中，我首先介绍的内容是当今最热门的信息流架构。信息流是推荐系统应用中的当红炸子鸡，它表现形式有很多：社交网络的动态信息流、新闻阅读的图文信息流、短视频信息流等等。 究竟。整体框架信息流，通常也叫作 feed，这个英文词也很有意思，就是“喂”给用户的意思。传统的信息流产品知识简单按照时间排序，而被推荐系统">
<meta property="og:locale">
<meta property="og:image" content="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E6%A1%86%E6%9E%B6.jpg">
<meta property="og:image" content="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/fan-out.jpg">
<meta property="og:image" content="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/fan-out-on-write.jpg">
<meta property="og:image" content="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/Netflix%E6%9E%B6%E6%9E%84.jpg">
<meta property="og:image" content="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/%E6%8E%A8%E8%8D%90%E7%AE%97%E6%B3%95%E7%A6%BB%E7%BA%BF%E5%B1%82.jpg">
<meta property="og:image" content="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/Netflix%E7%AE%80%E5%8C%96%E6%9E%B6%E6%9E%84.jpg">
<meta property="og:image" content="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/Netflix%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84%E5%AF%B9%E6%AF%94.jpg">
<meta property="og:image" content="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/%E6%90%9C%E7%B4%A2%26%E6%8E%A8%E8%8D%90%26%E5%B9%BF%E5%91%8A.jpg">
<meta property="og:image" content="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/%E5%B8%B8%E8%A7%81%E6%9E%B6%E6%9E%84.jpg">
<meta property="article:published_time" content="2018-11-08T16:00:00.000Z">
<meta property="article:modified_time" content="2025-01-12T12:48:46.660Z">
<meta property="article:author" content="小火箭">
<meta property="article:tag" content="机器学习">
<meta property="article:tag" content="推荐">
<meta property="article:tag" content="算法">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E6%A1%86%E6%9E%B6.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://www.xiemingzhao.com/posts/9d49d40e.html"/>





  <title>推荐系统三十六式--学习笔记（25-27 常见架构） | 小火箭的博客</title>
  








<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>


<script type="text/javascript"
color="0,0,0" opacity='0.5' zIndex="-1" count="150" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>


<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    
    <a href="https://github.com/xiemingzhao"><img style="position:absolute;top:0;right:0;border:0;" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_darkblue_121621.png?resize=149%2C149" class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">小火箭的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">愿世界和平！！！</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-comments"></i> <br />
            
            留言板
          </a>
        </li>
      
        
        <li class="menu-item menu-item-others">
          <a href="/others/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-folder"></i> <br />
            
            其他
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.xiemingzhao.com/posts/9d49d40e.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.postimg.cc/vBxZQfvz/img-0182.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小火箭的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">推荐系统三十六式--学习笔记（25-27 常见架构）</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-09T00:00:00+08:00">
                2018-11-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index">
                    <span itemprop="name">学习笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E4%B8%89%E5%8D%81%E5%85%AD%E5%BC%8F/" itemprop="url" rel="index">
                    <span itemprop="name">推荐系统三十六式</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/9d49d40e.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/posts/9d49d40e.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> 阅读数
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  7.4k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  25
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><a href="https://time.geekbang.org/column/intro/74">参考原作：推荐系统三十六式-刑无刀</a></p>
<h2 id="25-【常见架构】典型的信息流架构是什么样的"><a href="#25-【常见架构】典型的信息流架构是什么样的" class="headerlink" title="25.【常见架构】典型的信息流架构是什么样的"></a>25.【常见架构】典型的信息流架构是什么样的</h2><p>在工程实践的部分中，我首先介绍的内容是当今最热门的信息流架构。信息流是推荐系统应用中的当红炸子鸡，它表现形式有很多：社交网络的动态信息流、新闻阅读的图文信息流、短视频信息流等等。</p>
<h3 id="究竟。整体框架"><a href="#究竟。整体框架" class="headerlink" title="究竟。整体框架"></a><strong>究竟。整体框架</strong></h3><p>信息流，通常也叫作 feed，这个英文词也很有意思，就是“喂”给用户的意思。传统的信息流产品知识简单按照时间排序，而被推荐系统接管后的信息流逐渐成为主流，按照兴趣排序，也叫作“兴趣 feed”。所以我们通常提到信息流，或者兴趣 feed，其实都是在说同一个话题。</p>
<blockquote>
<p>温馨提示一下：如果要搜索 feed 相关的技术文章，你应该用“Activity Stream”作为关键词去搜，而不应该只用“feed”搜索，Activity Stream 之于 feed，就好比多潘立酮之于吗丁啉，前者是行话，后者是通俗说法。</p>
</blockquote>
<p>要实现一个信息流，整体逻辑上是比较清楚的。可以划分为两个子问题。</p>
<ol>
<li>如何实现一个按照时间顺序排序的信息流系统？</li>
<li>如何给信息流内容按照兴趣重排序？</li>
</ol>
<span id="more"></span>
<p><img src="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E6%A1%86%E6%9E%B6.jpg" alt="信息流推荐框架.jpg"><br>这张架构图划分成几个大的模块：<strong>日志收集、内容发布、机器学习、信息流服务、监控。</strong><br>这里分别介绍一下：</p>
<blockquote>
<ol>
<li>日志收集，是所有排序训练的数据来源，要收集的最核心数据就是用户在信息流上产生的行为，用于机器学习更新排序模型；</li>
<li>内容发布，就是用推或者拉的模式把信息流的内容从源头发布到受众端；</li>
<li>机器学习，从收集的用户行为日志中训练模型，然后为每一个用户即将收到的信息流内容提供打分服务；</li>
<li>信息流服务，为信息流的展示前端提供 Rest API；</li>
<li>监控，这是系统的运维标配，保证系统的安全和稳定等。</li>
</ol>
</blockquote>
<h3 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a><strong>数据模型</strong></h3><p>信息流的基本数据有三个：<strong>用户（User）、内容（Activity）和关系（Connection）。</strong> 用户不用说，就是区别不同用户的身份 ID，现在来说一说其他的两种。</p>
<h4 id="1-内容即-Activity"><a href="#1-内容即-Activity" class="headerlink" title="1.内容即 Activity"></a><strong>1.内容即 Activity</strong></h4><p>用于表达 Activity 的元素有相应的规范，叫作 Atom，你可以参考它并结合产品需求，定义出自己的信息流数据模型来。<br>根据 Atom 规范的定义，一条 Activity 包含的元素有：Time、Actor、Verb、Object、Target、Title、Summary。下面详细解释一下这些元素。</p>
<blockquote>
<ol>
<li>Time：即“Activity 发生的时间”。</li>
<li>Actor：即“Activity 由谁发出的”。通常 Actor 就是用户 ID，但是我们也可以扩展到其他拟人化物体上，如关注的一个“店铺”，收藏的一部“电影”，或者用户喜欢的一个标签或者分类。也就是和用户建立连接的另一端。</li>
<li>Verb：动词，就是连接的名字，比如“Follow”“Like”等，也可以是隐含的连接，如挖掘出的用户兴趣词和用户之间这种潜规则。</li>
<li>Object：即动作作用到最主要的对象，只能有一个，比如一个人赞过的一张照片，店铺上新的一件商品，一个分类下一篇新的文章。</li>
<li>Target：动作的最终目标，与 verb 有关，可以没有。它对应英语中介词 to 后接的事物，比如“John saved a movie to his wishlist”（John 保存了一部电影到清单里），这里电影就是 Object，而清单就是 Target。</li>
<li>Title：这个是 Activity 的标题，用自然语言描述，用于展示给用户。</li>
<li>Summary：通常是一小段 HTML 代码，是对这个 Activity 的描述，还可能包含类似缩略图这样的可视化元素，可以理解为 Activity 的视图，不是必须的。</li>
</ol>
</blockquote>
<p>除了上面的字段外，还有一个隐藏的 ID，用于唯一标识一个 Activity。社交电商 Etsy 在介绍他们的信息流系统时，还创造性地给 Activity 增加了 Owner 属性，同一个 Activity 可以属于不同的用户，相当于考虑了方向。</p>
<h4 id="2-关系即连接"><a href="#2-关系即连接" class="headerlink" title="2. 关系即连接"></a><strong>2. 关系即连接</strong></h4><p>互联网产品里处处皆连接，有强有弱，好友关系、关注关系等社交是较强的连接，还有点赞、收藏、评论、浏览，这些动作都可以认为是用户和另一个对象之间建立了连接。有了连接，就有信息流的传递和发布。<br>定义一个连接的元素有下面几种。</p>
<blockquote>
<ol>
<li>From：连接的发起方。</li>
<li>To：被连接方。</li>
<li>Type/Name：就是 Atom 模型中的 Verb，即连接的类型：关注、加好友、点赞、浏览、评论，等等。</li>
<li>Affinity：连接的强弱。</li>
</ol>
</blockquote>
<p>如果把建立一个连接视为一个 Activity 模型的话，From 就对应 Activity 中的 Actor，To 就对应 Activity 中的 Object。连接的发起从 From 到 To，内容的流动从 To 到 From。Connection 和 Activity 是相互加强的，这是蛋和鸡的关系：有了 Activity，就会产生 Connection，有了 Connection，就可以“喂”（feed）给你更多的 Activity。</p>
<p>在数据存储上可以选择的工具有下面的几种：<br>Activity 存储可以采用 MySQL、Redis、Cassandra 等； Connection 存储可以采用<br>MySQL； User 存储可以采用 MySQL。</p>
<h3 id="内容发布"><a href="#内容发布" class="headerlink" title="内容发布"></a><strong>内容发布</strong></h3><p>用户登录或者刷新后，信息流是怎么产生的呢？我们把内容出现在受众的信息流中这个过程称为 Fan-out，直觉上是这样实现的：</p>
<ol>
<li>获取用户所有连接的终点（如好友、关注对象、兴趣标签）；</li>
<li>获取这些连接终点（关注对象）产生的新内容（Activity）；</li>
<li>按照某个指标排序后输出。<br>上面这个步骤别看简单，在一个小型的社交网络上，通常很有效，而且 Twitter 早期也是这么做的。这就是江湖行话说的“拉”模式（Fan-out-on-load），即：<strong>信息流是在用户登录或者刷新后实时产生的</strong>。<br>这里有一个示意图:</li>
</ol>
<p><img src="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/fan-out.jpg" alt="fan-out.jpg"></p>
<p>拉模式就是当用户访问时，信息流服务才会去相应的发布源拉取内容到自己的 feed 区来，这是一个阻塞同步的过程。“拉”模式的好处也显而易见，主要有下面两种。</p>
<ol>
<li>实现简单直接：一行 SQL 语句就搞定了。</li>
<li>实时：内容产生了，受众只要刷新就看得见。</li>
</ol>
<p>但是也有很大的不足：</p>
<ol>
<li>随着连接数的增加，这个操作的复杂度指数级增加；</li>
<li>内存中要保留每个人产生的内容；</li>
<li>服务很难做到高可用。</li>
</ol>
<p>与“拉”模式对应，还有一个“推”模式（Fan-out-on-write），如下图所示：</p>
<p><img src="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/fan-out-on-write.jpg" alt="fan-out-on-write.jpg"></p>
<p>当一个 Actor 产生了一条 Activity 后，不管受众在不在线，刷没刷新，都会立即将这条内容推送给相应的用户（即和这个 Actor 建立了连接的人），系统为每一个用户单独开辟一个信息流存储区域，用于接收推送的内容。如此一来，当用户登录后，系统只需要读取他自己的信息流即可。</p>
<p>“推”模式的好处显而易见：<br>在用户访问自己的信息流时，几乎没有任何复杂的查询操作，所以服务可用性较高。</p>
<p>“推”模式也有一些不足：</p>
<ol>
<li>大量的写操作：每一个粉丝都要写一次。</li>
<li>大量的冗余存储：每一条内容都要存储 N 份（受众数量）。</li>
<li>非实时：一条内容产生后，有一定的延迟才会到达受众信息流中。</li>
<li>无法解决新用户的信息流产生问题。</li>
</ol>
<p>既然两者各有优劣，那么实际上就应该将两者结合起来，一种简单的结合方案是全局的：</p>
<ol>
<li>对于活跃度高的用户，使用推模式，每次他们刷新时不用等待太久，而且内容页相对多一些；</li>
<li>对于活跃度没有那么高的用户，使用拉模式，当他们登录时才拉取最新的内容；</li>
<li>对于热门的内容生产者，缓存其最新的 N 条内容，用于不同场景下的拉取。</li>
</ol>
<p>还有一种结合方案是分用户的，这是 Etsy 的设计方案：</p>
<blockquote>
<ol>
<li>如果受众用户与内容产生用户之间的亲密度高，则优先推送，因为更可能被这个受众所感兴趣；</li>
<li>如果受众用户与内容产生用户之间的亲密度低，则推迟推送或者不推送；</li>
<li>也不是完全遵循亲密度顺序，而是采用与之相关的概率。</li>
</ol>
</blockquote>
<p><strong>在中小型的社交网络上，采用纯推模式就够用了，结合的方案可以等业务发展到一定规模后再考虑。</strong></p>
<p>对于信息流的产生和存储可以选择的工具有：</p>
<ul>
<li>用户信息流的存储可以采用 Redis 等 KV 数据库, 使用 uid 作为 key。</li>
<li>信息流推送的任务队列可以采用 Celery 等成熟框架。</li>
</ul>
<p>信息流排序信息流的排序，要避免陷入两个误区：</p>
<ol>
<li>没有目标；</li>
<li>人工量化。<blockquote>
<p>“没有目标”意思就是说，设计排序算法之前，一定要先弄清楚为什么要对时间序重排？希望达到什么目标？只有先确定目标，才能检验和优化算法。<br>“人工量化”，也就是我们通常见到的产品同学或者运营同学要求对某个因素加权、降权。这样做很不明智，主要是不能很好地持续优化。</p>
</blockquote>
</li>
</ol>
<p>目前信息流采用机器学习排序，以提升类似互动率，停留时长等指标，这已经成为共识。比如说提高互动率则需要下面几个内容:<br>首先，定义好互动行为包括哪些，比如点赞、转发、评论、查看详情等；<br>其次，区分好正向互动和负向互动，比如隐藏某条内容、点击不感兴趣等是负向的互动。</p>
<p>基本上到这里就可以设计成一个典型的二分类监督学习问题了，能产生概率输出的二分类算法都可以用在这里，比如贝叶斯、最大熵、逻辑回归等。互联网常用的是逻辑回归（Logistic Regression），谁用谁知道，用过的都说好；也有 Facebook 等大厂采用了逻辑回归加梯度提升树模型（又称 GBDT）来对信息流排序，效果显著。</p>
<p>如今大厂都已经转向深度学习了，但我还是建议小厂或者刚起步的信息流先采用线性模型。<br>对于线性模型，一个重要的工作就是特征工程。<strong>信息流的特征有三类：</strong></p>
<blockquote>
<ol>
<li>用户特征，包括用户人口统计学属性、用户兴趣标签、活跃程度等；</li>
<li>内容特征，一条内容本身可以根据其属性提取文本、图像、音频等特征，并且可以利用主题模型提取更抽象的特征。</li>
<li>其他特征，比如刷新时间、所处页面等。</li>
</ol>
</blockquote>
<p><strong>排序模型在实际使用时，通常做成 RPC（远程过程调用协议） 服务，以供发布信息流时调用。</strong></p>
<h3 id="数据管道"><a href="#数据管道" class="headerlink" title="数据管道"></a><strong>数据管道</strong></h3><p>这个管道中要使用的相关数据可能有：</p>
<blockquote>
<ol>
<li>互动行为数据，用于记录每一个用户在信息流上的反馈行为；</li>
<li>曝光内容，每一条曝光要有唯一的 ID，曝光的内容仅记录 ID 即可；</li>
<li>互动行为与曝光的映射关系，每条互动数据要对应到一条曝光数据；</li>
<li>用户画像内容，即用户画像，提供用户特征，具体请见我在第 4、5、6 三篇中的内容；</li>
<li>信息流的内容分析数据，提供内容特征，即物品画像。</li>
</ol>
</blockquote>
<p>对于一个从零开始的信息流，没必要做到在线实时更新排序算法的参数，所以数据的管道可以分成三块：</p>
<ol>
<li>生成训练样本，可离线；</li>
<li>排序模型训练，可离线；</li>
<li>模型服务化，实时服务；像 Pinterest 早期的管道也差不多就是这样。</li>
</ol>
<p>在离线训练优化模型时，关注模型的 AUC 是否有提升，线上 AB 测试时关注具体的产品目标是否有提升，比如互动率等，同时还要根据产品具体形态关注一些辅助指标。<br>另外，互动数据相比全部曝光数据，数量会小得多，所以在生成训练数据时需要对负样本（展示了却没有产生互动的样本）进行采样，采样比例也是一个可以优化的参数。<br>固定算法和特征后，在 0.1~0.9 之间遍历对比实验，选择最佳的正负比例即可。经验比例在 2:3 左右，即负样本略大于正样本，你可以用这个比例做启发式搜索。</p>
<hr>
<h2 id="26-【常见架构】Netflix个性化推荐架构"><a href="#26-【常见架构】Netflix个性化推荐架构" class="headerlink" title="26.【常见架构】Netflix个性化推荐架构"></a>26.【常见架构】Netflix个性化推荐架构</h2><p>工程落地很重要，虽然影响是否用户产品的因素有很多很多，但是能否流畅地给用户提供服务是一个最基本的标准。</p>
<h3 id="架构的重要性"><a href="#架构的重要性" class="headerlink" title="架构的重要性"></a><strong>架构的重要性</strong></h3><p>推荐系统向来是一个锦上添花的东西，因此传统的观点是推荐系统更加注重线下的模型效果，而非线上的服务质量。但是你也知道，时至今日，推荐系统不再只是锦上添花，而是承担了产品的核心功能。因此，对推荐系统架构的要求也高了很多：</p>
<ol>
<li>实时响应请求；</li>
<li>及时、准确、全面记录用户反馈；</li>
<li>可以优雅降级；</li>
<li>快速实验多种策略。</li>
</ol>
<p>一种更符合经典推荐系统的架构，这就是著名的流媒体Netflix 的推荐系统架构。</p>
<h3 id="经典架构"><a href="#经典架构" class="headerlink" title="经典架构"></a><strong>经典架构</strong></h3><p><img src="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/Netflix%E6%9E%B6%E6%9E%84.jpg" alt="Netflix架构.jpg"></p>
<p><strong>先整体看一下这个架构，一共分成三层：在线、近线、离线。</strong></p>
<p>可以这样定义这三个层级：</p>
<ol>
<li>离线：不用实时数据，不提供实时服务；</li>
<li>近线：使用实时数据，不保证实时服务；</li>
<li>在线：使用实时数据，要保证实时服务。</li>
</ol>
<h4 id="1-数据流"><a href="#1-数据流" class="headerlink" title="1. 数据流"></a><strong>1. 数据流</strong></h4><p>用户在产品 UI 上使用产品，消费展示的内容，产生行为事件数据，实时地被收集走，一边进入分布式的文件系统中存储，供离线阶段使用，另一边流向近线层的消息队列，供近线阶段的流计算使用。</p>
<p>离线存储的全量数据被抽取出来，组成离线计算所需的训练数据，这些训练数据被一个管理数据生成和发布的组件统一管理，要使用数据的下游，比如模型训练会在离线数据生成时得到这个组件的通知，从而开始训练，训练得到的模型用于进一步为用户计算推荐结果。</p>
<p>离线阶段的推荐结果或者模型在近线阶段被更新，进一步在在线阶段被直接使用，产生最终的推荐结果，呈现给用户。</p>
<h4 id="2-在线层"><a href="#2-在线层" class="headerlink" title="2. 在线层"></a><strong>2. 在线层</strong></h4><p>在线层的触发时机是当用户发出请求，也就是用户进入一个推荐场景，推荐位等着展示推荐结果时，这个时候需要承担责任就是在线层。在线层就是实时响应用户请求。简单说，在线层的特点就是<strong>“使用实时数据，要保证实时服务”。</strong></p>
<p>在线层的优势有：</p>
<ol>
<li>直接首次接触到大多数最新数据；</li>
<li>对用户请求时的上下文了如指掌；</li>
<li>只需计算必须的信息，不需要考虑所有的信息。</li>
</ol>
<p>在线层也有严格的制约：</p>
<ol>
<li>严格的服务响应时间，不能超时，或者让用户等太久；</li>
<li>服务要保证可用性，稳定性；</li>
<li>传输的数据有限。</li>
</ol>
<p>在线层常常展现出的形式就是 Rest API 形式，后端则通常是 RPC 服务内部互相调用，以用户 ID、场景信息去请求，通常就在 ms 响应时间内返回 Json 形式的推荐结果。那么哪些计算逻辑适合放在在线层呢？</p>
<blockquote>
<ol>
<li>简单的算法逻辑；</li>
<li>模型的预测阶段；</li>
<li>商业目标相关的过滤或者调权逻辑；</li>
<li>场景有关的一些逻辑；</li>
<li>互动性强的一些算法。</li>
</ol>
</blockquote>
<p>在线阶段要处理的对象一般是已经预处理后的推荐结果，是少量物品集合。比如说当用户访问一个物品详情页，需要做相关推荐，那么在线阶段给在线服务的 Rest API 传入用户身份以及当前的物品 ID，实时地取出物品 ID 对应的相关物品 ID，再根据用户信息对这些物品 ID 做一些重拍和过滤，就可以输出了，整个过程都是在 ms 级别完成。如果发生意外，比如说这个物品 ID 就没有相关的物品，那么这时候服务就需要降级，但是不能低于最低要求，这里的最低要求就是必须要返回东西，这就降级为取出热门排行榜返回。这就是服务的可用性。</p>
<h4 id="3-离线层"><a href="#3-离线层" class="headerlink" title="3. 离线层"></a><strong>3. 离线层</strong></h4><p>讲完在线层，再来看看离线层。离线层就是躲在推荐系统的大后方，批量、周期性地执行一些计算任务。其特点是<strong>“不用实时数据，不提供实时服务”。</strong><br>离线层的示意图如下：</p>
<p><img src="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/%E6%8E%A8%E8%8D%90%E7%AE%97%E6%B3%95%E7%A6%BB%E7%BA%BF%E5%B1%82.jpg" alt="offline.jpg"></p>
<p>离线阶段主要面对的数据源就是 Hadoop，实质上是 HDFS。收集到的所有日志都存在这里面，是一个全量的数据中心。通过 Pig 或者 Hive 等工具，从全量日志中按照算法要求抽取出不同的数据，再加上其他数据变成了不同算法所需的数据源。</p>
<p>如果这种数据源比较多时，就需要有专门的工具统一管理起来，这个管理上要求：</p>
<ol>
<li>数据准备好之后及时通知相关方，也就是要有订阅发布的模式；</li>
<li>能够满足下游不同的存储系统；</li>
<li>完整的监控体系，并且监控过程对于数据使用方是透明的。</li>
</ol>
<p>在 Netflix 内部，承担这个管理任务的工具叫做 Hermes，类似 Kafka，但是又有不同的内部工具。<br><strong>离线阶段的任务主要是两类：模型训练和推荐结果计算。</strong></p>
<p>离线阶段有以下这么几个好处：</p>
<ol>
<li>可以处理最大的数据量；</li>
<li>可进行批量处理和计算；</li>
<li>不用有响应时间等要求。当然坏处也是明显的：</li>
</ol>
<p>同样的有几点短处：</p>
<ol>
<li>无法及时响应前端需求；</li>
<li>面对的数据较静态，无法及时反应用户的兴趣变化。</li>
</ol>
<p>大多数推荐算法，实际上都是在离线阶段产生推荐结果的。离线阶段的推荐计算和模型训练，<strong>如果要用分布式框架，通常可以选择 Spark</strong> 等。</p>
<h4 id="4-近线层"><a href="#4-近线层" class="headerlink" title="4. 近线层"></a><strong>4. 近线层</strong></h4><p>最后，来讲讲近线层。近线层的特点是<strong>“使用实时数据，不保证实时服务”</strong>。</p>
<p>虽然这看上去蛮不讲理，但实际上这是一个非常重要的一层，它结合了离线层和在线层的好处，摒弃了两者的不足。近线层，也叫做<strong>准实时层</strong>，所谓“准实时”，就是接近实时，但不是真的实时。</p>
<p>从前面的架构图中也可以看出，这一层的数据来源是实时的行为事件队列，但是计算的结果并不是沿着输入数据的方向原路返回，而是进入了在线数据库中，得到用户真正发起请求时，再提供服务。</p>
<p>一个典型的近线计算任务是这样的：从事件队列中获取最新的一个或少许几个用户反馈行为，首先将这些用户已经反馈过的物品从离线推荐结果中剔除，进一步，用这几个反馈行为作为样本，以小批量梯度下降的优化方法去更新融合模型的参数。</p>
<p>这两个计算任务都不会也不需要立即对用户做出响应，也不必须在下一次用户请求时就产生效果，就是说当用户实时请求时，不需要去等待近线任务的最新结果，因为两者是异步的。</p>
<p>近线计算任务一个核心的组件就是流计算，因为它要处理的实时数据流。常用的流计算框架有<strong>Storm，Spark Streaming，FLink 等</strong>，Netflix 采用的内部流计算框架 Manhattan，这和Storm 类似。略有区别的是 Spark Streaming，实际上并不是实时流计算，而是小批量计算。</p>
<h3 id="简化架构"><a href="#简化架构" class="headerlink" title="简化架构"></a><strong>简化架构</strong></h3><p>Netflix 是为全球多个国家同时提供在线服务的，因此推荐系统的架构略微复杂。倘若你现在刚刚接手一个新产品，要从 0 开始搭建一个推荐系统，那么可以以 Netflix 的架构作为蓝本，做一定的简化：</p>
<p><img src="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/Netflix%E7%AE%80%E5%8C%96%E6%9E%B6%E6%9E%84.jpg" alt="Netflix简化架构.jpg"></p>
<p>关键简化有两点：</p>
<ol>
<li>完全舍弃掉近线层；</li>
<li>避免使用分布式系统。</li>
</ol>
<p>在一个新产品的场景下， 当数据量还没有那么大时，使用分布式存储或者计算框架，非常不划算。如果性能不足，请升级单机配置。根据经验，一个几千万用户，几十万到百万的物品的协同过滤或者矩阵分解，如果充分发挥单机的性能，综合效率会远远优于在 Spark 上运行。</p>
<p><img src="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/Netflix%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84%E5%AF%B9%E6%AF%94.jpg" alt="Netflix三层架构对比.jpg"></p>
<p>以上就是对这个架构的宏观总结对比。如前所说，其实架构都是进化出来的，你千万不必在一开始就追求完美的架构，满足最低要求就好。</p>
<hr>
<h2 id="27-【常见架构】总览推荐架构和搜索、广告的关系"><a href="#27-【常见架构】总览推荐架构和搜索、广告的关系" class="headerlink" title="27.【常见架构】总览推荐架构和搜索、广告的关系"></a>27.【常见架构】总览推荐架构和搜索、广告的关系</h2><h3 id="三种信息获取方式"><a href="#三种信息获取方式" class="headerlink" title="三种信息获取方式"></a><strong>三种信息获取方式</strong></h3><p>当用户想要从浩如烟海的网页中，找到对自己有用的信息，首选当然是搜索引擎，这是属于“已知的未知”需求，剩下的“未知的已知”和“未知的未知”则需要推荐系统去满足，只是推荐系统常常会出现画蛇添足去满足“已知的已知”这样的伪需求。<br>另外介于两者之间，还有一种商业化解决信息触达问题，就是广告系统。在线广告从条幅广告，到搜索广告再到社交精准广告，也逐渐形成了一个理念就是：把广告当成一种有用的信息去找到最需要它的人。</p>
<h3 id="三者对比"><a href="#三者对比" class="headerlink" title="三者对比"></a><strong>三者对比</strong></h3><p>搜索，推荐和广告本质上都在解决信息过载的问题，各自解决的手段、目标不相同，各自诞生在产品生命周期不同阶段，以至于系统实现也不尽相同。我们从几个维度对比一下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">-</th>
<th style="text-align:center">搜索</th>
<th style="text-align:center">推荐</th>
<th style="text-align:center">广告</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">信息送达方式</td>
<td style="text-align:center">拉</td>
<td style="text-align:center">推和拉</td>
<td style="text-align:center">推</td>
</tr>
<tr>
<td style="text-align:center">关注点</td>
<td style="text-align:center">内容消费方</td>
<td style="text-align:center">内容生产方消费方</td>
<td style="text-align:center">内容生产方</td>
</tr>
<tr>
<td style="text-align:center">是否期待惊喜</td>
<td style="text-align:center">否</td>
<td style="text-align:center">是</td>
<td style="text-align:center">否</td>
</tr>
<tr>
<td style="text-align:center">是否需要集体智慧</td>
<td style="text-align:center">可能</td>
<td style="text-align:center">可能</td>
<td style="text-align:center">需要</td>
</tr>
<tr>
<td style="text-align:center">是否需要query</td>
<td style="text-align:center">需要</td>
<td style="text-align:center">可能</td>
<td style="text-align:center">可能</td>
</tr>
<tr>
<td style="text-align:center">是否依赖上下文</td>
<td style="text-align:center">可能</td>
<td style="text-align:center">可能</td>
<td style="text-align:center">可能</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>搜索更关注内容消费者，搜索要解决的是精确快速找到想要的结果，最重要的目标是降低延迟和提高相关性。搜索引擎是一个效率工具，希望用户找到信息越快越好，而不是希望用户沉迷在搜索引擎中。</li>
<li>传统的推荐系统大都是起一个“锦上添花”的作用，一般很少会将其作为核心功能来承载产品。希望用户消费内容，消费越多越好。可以给用户制造惊喜。</li>
<li>基于内容的推荐，本质上就是一个小的搜索引擎。例如使用用户的兴趣标签召回推荐结果，就需要先对推荐候选池按照兴趣标签建立倒排索引，从而检索出候选集。</li>
<li>广告是一个很特殊的存在，前面也说了，搜索和推荐都是为人找信息，而广告是为信息找人。但它在形式上又像推荐，总是“不请自来”，在技术实现上又兼有推荐和搜索两者特点。</li>
</ul>
<h3 id="架构抽象"><a href="#架构抽象" class="headerlink" title="架构抽象"></a><strong>架构抽象</strong></h3><p>我们抽象一下三者的需求共性：本质上都是在匹配，匹配用户的兴趣和需求（看成 context），但匹配的目标，条件和策略不尽相同。示意图如下：</p>
<p><img src="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/%E6%90%9C%E7%B4%A2%26%E6%8E%A8%E8%8D%90%26%E5%B9%BF%E5%91%8A.jpg" alt="搜索&amp;推荐&amp;广告.jpg"></p>
<p><strong>我们再进一步抽象下去，又可以分为三步：过滤候选、排序候选、个性化输出。</strong></p>
<h4 id="1-过滤候选"><a href="#1-过滤候选" class="headerlink" title="1. 过滤候选"></a><strong>1. 过滤候选</strong></h4><p>从查询关键字中解析得到查询意图，以及结构化的搜索条件，再用结构化的查询条件从倒排索引中检索出排序候选。与之相似的是广告系统，搜索广告也是查询关键字去检索候选广告，而联盟广告则是拿着用户标签去需求方获取广告候选。</p>
<p>在推荐系统中，一再强调有挖掘、召回和排序三个阶段，其中的召回阶段就是过滤候选阶段，基于内容的就和搜索一样，用标签检索候选，协同过滤则检索出相似物品来，等等。</p>
<p>一种离线阶段的推荐算法对应一种召回策略，为了保证高效地召回，都要建立相应的索引，这样一来，是不是搜索、广告和推荐都离不开过滤候选这一步，而过滤候选就离不开建立索引。</p>
<h4 id="2-排序候选"><a href="#2-排序候选" class="headerlink" title="2. 排序候选"></a><strong>2. 排序候选</strong></h4><p>候选排序这一步，对于三者来说，主要区别在于排序的目标和约束。搜索的排序目标是高相关性，无论 BM25 为代表的传统排序模型，还是以 Learn to Rank 为代表的机器学习排序皆是如此，把<strong>用户每次在搜索上花费的时间是不是更少（而不是更多）来衡量搜索的效果</strong>。</p>
<p>通常推荐系统用 CTR 预估来融合召回策略得到的候选集，如果做得深入，还需要考虑探索利用问题。附加的约束则是千变万化。电商中，当天买过的当天就不能再推了，新闻推荐里，重复的新闻不能再推了。某些场景需要推荐搭配，某些场景需要推荐相似，TopN 推荐还需要考虑多样性，序列推荐要考虑前序和后续等等。</p>
<p>广告系统的排序更多是从经济学角度去看，CPC 广告的排序方式是结合预估 CTR、出价、广告质量三者一起考虑。同时还要考虑很多别的因素，尤其是商业因素，平台方的要求，广告主的要求等等，是一个纯动态的博弈。</p>
<h4 id="3-个性化输出"><a href="#3-个性化输出" class="headerlink" title="3.个性化输出"></a><strong>3.个性化输出</strong></h4><p>个性化只是推荐系统的衡量指标之一而已，个性化的前提也一定是信息够丰富够垂直才行。搜索的个性化需求相对来说松弛一些，常见的是利用地域等人口统计学体现个性化，而且对于歧义较少的查询关键字，搜索如果太个性化既没意义又有风险。</p>
<h4 id="4-三者的协同"><a href="#4-三者的协同" class="headerlink" title="4.三者的协同"></a><strong>4.三者的协同</strong></h4><p>有一部分搜索需求是无法用搜索相关性满足的，比如“一个人的夜晚听什么歌”这样的 query，这就需要推荐系统去满足，交互形式可能是眼下大热的聊天机器人，也可能是流推荐等等。如果能够识别出这样的搜索请求，其实更应该交给推荐系统来响应，这类是看似搜索请求，实际上则是漫无目的。</p>
<p><strong>推荐系统总体上滞后于用户的即时需求，再强大的推荐系统，也要有搜索引擎来与之配合。</strong></p>
<ul>
<li>一方面，搜索因为能够满足用户的主动寻找需求，所以能够化解一些推荐不力不及时的尴尬。</li>
<li>另一方面，搜索可以积累用户兴趣数据；当二者结合起来考虑时，可以避免“搜什么推什么”的窘境，整个系统能够综合考虑哪些是即时快速需求，哪些是长期兴趣。</li>
</ul>
<p>广告系统，在技术上和搜索跟推荐并无本质差异，差异在意图不同，功能不同。对用户的信息需求满足，搜索和推荐离真正得到满足之间总是有一定的鸿沟，要么是信息不足，要么是信息过载，这些鸿沟可以利用经济手段进行调配，这就是广告系统。</p>
<p><img src="https://mzxie-image.oss-cn-hangzhou.aliyuncs.com/recSystem36L/%E5%B8%B8%E8%A7%81%E6%9E%B6%E6%9E%84.jpg" alt="常见架构.jpg"></p>
<hr>

      
    </div>
    
    
    
    
    <div>
      
      <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
      
    </div>

    <div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/posts/9d49d40e.html">推荐系统三十六式--学习笔记（25-27 常见架构）</a></p>
  <p><span>文章作者:</span><a href="/" title="访问  的个人博客"></a></p>
  <p><span>原始链接:</span><a href="/posts/9d49d40e.html" title="推荐系统三十六式--学习笔记（25-27 常见架构）">https://www.xiemingzhao.com/posts/9d49d40e.html</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://www.xiemingzhao.com/posts/9d49d40e.html"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
      $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
        });
    });  
</script>

      
    </div>

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i> 机器学习</a>
          
            <a href="/tags/%E6%8E%A8%E8%8D%90/" rel="tag"><i class="fa fa-tag"></i> 推荐</a>
          
            <a href="/tags/%E7%AE%97%E6%B3%95/" rel="tag"><i class="fa fa-tag"></i> 算法</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/posts/fc21f391.html" rel="next" title="推荐系统三十六式--学习笔记（22-24 其他应用算法）">
                <i class="fa fa-chevron-left"></i> 推荐系统三十六式--学习笔记（22-24 其他应用算法）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/posts/6ea3699c.html" rel="prev" title="推荐系统三十六式--学习笔记（28-31 关键模块）">
                推荐系统三十六式--学习笔记（28-31 关键模块） <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
  <div class="bdsharebuttonbox">
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a>
    <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
    <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a class="bds_count" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "16",
        "bdStyle": "0"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://i.postimg.cc/vBxZQfvz/img-0182.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">61</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">64</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/xiemingzhao" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="514829265@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-globe"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#25-%E3%80%90%E5%B8%B8%E8%A7%81%E6%9E%B6%E6%9E%84%E3%80%91%E5%85%B8%E5%9E%8B%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%9E%B6%E6%9E%84%E6%98%AF%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84"><span class="nav-number">1.</span> <span class="nav-text">25.【常见架构】典型的信息流架构是什么样的</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A9%B6%E7%AB%9F%E3%80%82%E6%95%B4%E4%BD%93%E6%A1%86%E6%9E%B6"><span class="nav-number">1.1.</span> <span class="nav-text">究竟。整体框架</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.2.</span> <span class="nav-text">数据模型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%86%85%E5%AE%B9%E5%8D%B3-Activity"><span class="nav-number">1.2.1.</span> <span class="nav-text">1.内容即 Activity</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%85%B3%E7%B3%BB%E5%8D%B3%E8%BF%9E%E6%8E%A5"><span class="nav-number">1.2.2.</span> <span class="nav-text">2. 关系即连接</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AE%B9%E5%8F%91%E5%B8%83"><span class="nav-number">1.3.</span> <span class="nav-text">内容发布</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%AE%A1%E9%81%93"><span class="nav-number">1.4.</span> <span class="nav-text">数据管道</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#26-%E3%80%90%E5%B8%B8%E8%A7%81%E6%9E%B6%E6%9E%84%E3%80%91Netflix%E4%B8%AA%E6%80%A7%E5%8C%96%E6%8E%A8%E8%8D%90%E6%9E%B6%E6%9E%84"><span class="nav-number">2.</span> <span class="nav-text">26.【常见架构】Netflix个性化推荐架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%B6%E6%9E%84%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7"><span class="nav-number">2.1.</span> <span class="nav-text">架构的重要性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%8F%E5%85%B8%E6%9E%B6%E6%9E%84"><span class="nav-number">2.2.</span> <span class="nav-text">经典架构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%95%B0%E6%8D%AE%E6%B5%81"><span class="nav-number">2.2.1.</span> <span class="nav-text">1. 数据流</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%9C%A8%E7%BA%BF%E5%B1%82"><span class="nav-number">2.2.2.</span> <span class="nav-text">2. 在线层</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E7%A6%BB%E7%BA%BF%E5%B1%82"><span class="nav-number">2.2.3.</span> <span class="nav-text">3. 离线层</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E8%BF%91%E7%BA%BF%E5%B1%82"><span class="nav-number">2.2.4.</span> <span class="nav-text">4. 近线层</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E5%8C%96%E6%9E%B6%E6%9E%84"><span class="nav-number">2.3.</span> <span class="nav-text">简化架构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#27-%E3%80%90%E5%B8%B8%E8%A7%81%E6%9E%B6%E6%9E%84%E3%80%91%E6%80%BB%E8%A7%88%E6%8E%A8%E8%8D%90%E6%9E%B6%E6%9E%84%E5%92%8C%E6%90%9C%E7%B4%A2%E3%80%81%E5%B9%BF%E5%91%8A%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-number">3.</span> <span class="nav-text">27.【常见架构】总览推荐架构和搜索、广告的关系</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E7%A7%8D%E4%BF%A1%E6%81%AF%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F"><span class="nav-number">3.1.</span> <span class="nav-text">三种信息获取方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E8%80%85%E5%AF%B9%E6%AF%94"><span class="nav-number">3.2.</span> <span class="nav-text">三者对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%B6%E6%9E%84%E6%8A%BD%E8%B1%A1"><span class="nav-number">3.3.</span> <span class="nav-text">架构抽象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E8%BF%87%E6%BB%A4%E5%80%99%E9%80%89"><span class="nav-number">3.3.1.</span> <span class="nav-text">1. 过滤候选</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%8E%92%E5%BA%8F%E5%80%99%E9%80%89"><span class="nav-number">3.3.2.</span> <span class="nav-text">2. 排序候选</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E4%B8%AA%E6%80%A7%E5%8C%96%E8%BE%93%E5%87%BA"><span class="nav-number">3.3.3.</span> <span class="nav-text">3.个性化输出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E4%B8%89%E8%80%85%E7%9A%84%E5%8D%8F%E5%90%8C"><span class="nav-number">3.3.4.</span> <span class="nav-text">4.三者的协同</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小火箭</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">信仰</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>


<!--

  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>

-->



<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共271.8k字</span>
</div>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!-- 网站运行时间的设置 -->
<!--
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>  Sometimes your whole life boils down to one insame move.
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("03/09/2019 13:14:21");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>
-->
        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'TpMiFGGr4T8FnG248uRRaf4H-gzGzoHsz',
        appKey: 'NYRTcUPshFEJWpUk54Bfu4nX',
        placeholder: '朋友记得留下昵称和邮箱，我会尽快回复您的！',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  


  

  <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":true,"log":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true}});</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
